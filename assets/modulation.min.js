$(function(){function t(i){this.canvas=document.getElementById(i.canvasId),this.minX=i.minX,this.minY=i.minY,this.maxX=i.maxX,this.maxY=i.maxY,this.unitsPerTickX=i.unitsPerTickX,this.unitsPerTickY=i.unitsPerTickY,this.axisColor="#aaa",this.font="18pt Crimson Text",this.tickSize=15,this.context=this.canvas.getContext("2d"),this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.restore(),this.rangeX=this.maxX-this.minX,this.rangeY=this.maxY-this.minY,this.unitX=this.canvas.width/this.rangeX,this.unitY=this.canvas.height/this.rangeY,this.centerY=Math.round(Math.abs(this.minY/this.rangeY)*this.canvas.height),this.centerX=Math.round(Math.abs(this.minX/this.rangeX)*this.canvas.width),this.iteration=(this.maxX-this.minX)/500,this.scaleX=this.canvas.width/this.rangeX,this.scaleY=this.canvas.height/this.rangeY,this.drawXAxis(),this.drawYAxis()}t.prototype.drawXAxis=function(){var i=this.context;i.save(),i.beginPath(),i.moveTo(0,this.centerY),i.lineTo(this.canvas.width,this.centerY),i.strokeStyle=this.axisColor,i.lineWidth=2,i.stroke();var t=this.unitsPerTickX*this.unitX,e,s;for(i.font=this.font,i.textAlign="center",i.textBaseline="top",e=this.centerX-t,s=-1*this.unitsPerTickX;e>0;)i.moveTo(e,this.centerY-this.tickSize/2),i.lineTo(e,this.centerY+this.tickSize/2),i.stroke(),i.fillText(s,e,this.centerY+this.tickSize/2+3),s-=this.unitsPerTickX,e=Math.round(e-t);for(e=this.centerX+t,s=this.unitsPerTickX;e<this.canvas.width;)i.moveTo(e,this.centerY-this.tickSize/2),i.lineTo(e,this.centerY+this.tickSize/2),i.stroke(),i.fillText(s,e,this.centerY+this.tickSize/2+3),s+=this.unitsPerTickX,e=Math.round(e+t);i.restore()},t.prototype.drawYAxis=function(){var i=this.context;i.save(),i.beginPath(),i.moveTo(this.centerX,0),i.lineTo(this.centerX,this.canvas.height),i.strokeStyle=this.axisColor,i.lineWidth=2,i.stroke();var t=this.unitsPerTickY*this.unitY,e,s;for(i.font=this.font,i.textAlign="right",i.textBaseline="middle",e=this.centerY-t,s=this.unitsPerTickY;e>0;)i.moveTo(this.centerX-this.tickSize/2,e),i.lineTo(this.centerX+this.tickSize/2,e),i.stroke(),i.fillText(s,this.centerX-this.tickSize/2-3,e),s+=this.unitsPerTickY,e=Math.round(e-t);for(e=this.centerY+t,s=-1*this.unitsPerTickY;e<this.canvas.height;)i.moveTo(this.centerX-this.tickSize/2,e),i.lineTo(this.centerX+this.tickSize/2,e),i.stroke(),i.fillText(s,this.centerX-this.tickSize/2-3,e),s-=this.unitsPerTickY,e=Math.round(e+t);i.restore()},t.prototype.drawEquation=function(i,t,e){var s=this.context;s.save(),s.save(),this.transformContext(),s.beginPath(),s.moveTo(this.minX,i(this.minX));for(var n=this.minX+this.iteration;n<=this.maxX;n+=this.iteration)s.lineTo(n,i(n));s.restore(),s.lineJoin="round",s.lineWidth=e,s.strokeStyle=t,s.stroke(),s.restore()},t.prototype.transformContext=function(){var i=this.context;this.context.translate(this.centerX,this.centerY),i.scale(this.scaleX,-this.scaleY)};var e=[{period:12.42,amplitude:.24,phase:0,color:"green"},{period:12,amplitude:.11,phase:0,color:"red"}],s=Math.floor(12/(e.length+1)),n=e.length,a=$("#template").html();for(i=1;i<=n;i++)waveTemplate=a.replace(new RegExp("{i}","g"),i),inputs=$("#inputs").html(),$("#inputs").html(inputs+""+waveTemplate);for($("#inputs > div").addClass("col-md-"+s),$(".actions").addClass("col-md-"+s),$("form").on("submit change",function(s){s.preventDefault();var a=new t({canvasId:"summed",minX:-60,minY:-2.1,maxX:60,maxY:2.1,unitsPerTickX:30,unitsPerTickY:1});a.drawEquation(function(t){for(sum=0,i=1;i<=n;i++){var e=$('[name="period_'+i+'"]').val(),s=$('[name="amplitude_'+i+'"]').val(),a=$('[name="phase_'+i+'"]').val();e>0&&(sum+=s*Math.sin(2*Math.PI/e*t-2*Math.PI*a))}return sum},"blue",3);var h=new t({canvasId:"single",minX:-60,minY:-1.1,maxX:60,maxY:1.1,unitsPerTickX:30,unitsPerTickY:1});for(i=1;i<=n;i++)h.drawEquation(function(t){var e=$('[name="period_'+i+'"]').val(),s=$('[name="amplitude_'+i+'"]').val(),n=$('[name="phase_'+i+'"]').val();return e>0?s*Math.sin(2*Math.PI/e*t-2*Math.PI*n):null},e[i-1].color,3)}),$("#sawTooth").on("click",function(i){i.preventDefault(),$("#period-1").val(24),$("#period-2").val(12),$("#amplitude-1").val(1),$("#amplitude-2").val(.2),$("#phase-1").val(0),$("#phase-2").val(.5),$("form").change()}),$("#aSymmetric").on("click",function(i){i.preventDefault(),$("#period-1").val(24),$("#period-2").val(12),$("#amplitude-1").val(1),$("#amplitude-2").val(.25),$("#phase-1").val(0),$("#phase-2").val(.25),$("form").change()}),i=1;i<=n;i++)$("#period-"+i).noUiSlider({start:[e[i-1].period],step:.1,range:{min:[0],max:[60]}}).on("slide",function(){$(this).change()}).Link("lower").to($('input[name="period_'+i+'"]')),$('input[name="period_'+i+'"]').keydown(function(t){var e=$("#period-"+i),s=Number(e.val()),n=e.noUiSlider("step");switch(n=n[0],t.which){case 13:$(this).change();break;case 38:e.val(s+n[1]),$(this).change();break;case 40:e.val(s-n[0]),$(this).change()}}),$("#amplitude-"+i).noUiSlider({start:[e[i-1].amplitude],step:.01,range:{min:[0],max:[1]}}).on("slide",function(){$(this).change()}).Link("lower").to($('input[name="amplitude_'+i+'"]')),$('input[name="amplitude_'+i+'"]').keydown(function(t){var e=$("#amplitude-"+i),s=Number(e.val()),n=e.noUiSlider("step");switch(n=n[0],t.which){case 13:$(this).change();break;case 38:e.val(s+n[1]),$(this).change();break;case 40:e.val(s-n[0]),$(this).change()}}),$("#phase-"+i).noUiSlider({start:[e[i-1].phase],step:.01,range:{min:[-1],max:[1]}}).on("slide",function(){$(this).change()}).Link("lower").to($('input[name="phase_'+i+'"]')),$('input[name="phase_'+i+'"]').keydown(function(t){var e=$("#phase-"+i),s=Number(e.val()),n=e.noUiSlider("step");switch(n=n[0],t.which){case 13:$(this).change();break;case 38:e.val(s+n[1]),$(this).change();break;case 40:e.val(s-n[0]),$(this).change()}})});