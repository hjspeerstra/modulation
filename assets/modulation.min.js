$(function(){function t(t){this.canvas=document.getElementById(t.canvasId),this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this.unitsPerTickX=t.unitsPerTickX,this.unitsPerTickY=t.unitsPerTickY,this.axisColor="#aaa",this.font="18pt Crimson Text",this.tickSize=15,this.context=this.canvas.getContext("2d"),this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.restore(),this.rangeX=this.maxX-this.minX,this.rangeY=this.maxY-this.minY,this.unitX=this.canvas.width/this.rangeX,this.unitY=this.canvas.height/this.rangeY,this.centerY=Math.round(Math.abs(this.minY/this.rangeY)*this.canvas.height),this.centerX=Math.round(Math.abs(this.minX/this.rangeX)*this.canvas.width),this.iteration=(this.maxX-this.minX)/300,this.scaleX=this.canvas.width/this.rangeX,this.scaleY=this.canvas.height/this.rangeY,this.drawXAxis(),this.drawYAxis()}t.prototype.drawXAxis=function(){var t=this.context;t.save(),t.beginPath(),t.moveTo(0,this.centerY),t.lineTo(this.canvas.width,this.centerY),t.strokeStyle=this.axisColor,t.lineWidth=2,t.stroke();var i=this.unitsPerTickX*this.unitX,e,s;for(t.font=this.font,t.textAlign="center",t.textBaseline="top",e=this.centerX-i,s=-1*this.unitsPerTickX;e>0;)t.moveTo(e,this.centerY-this.tickSize/2),t.lineTo(e,this.centerY+this.tickSize/2),t.stroke(),t.fillText(s,e,this.centerY+this.tickSize/2+3),s-=this.unitsPerTickX,e=Math.round(e-i);for(e=this.centerX+i,s=this.unitsPerTickX;e<this.canvas.width;)t.moveTo(e,this.centerY-this.tickSize/2),t.lineTo(e,this.centerY+this.tickSize/2),t.stroke(),t.fillText(s,e,this.centerY+this.tickSize/2+3),s+=this.unitsPerTickX,e=Math.round(e+i);t.restore()},t.prototype.drawYAxis=function(){var t=this.context;t.save(),t.beginPath(),t.moveTo(this.centerX,0),t.lineTo(this.centerX,this.canvas.height),t.strokeStyle=this.axisColor,t.lineWidth=2,t.stroke();var i=this.unitsPerTickY*this.unitY,e,s;for(t.font=this.font,t.textAlign="right",t.textBaseline="middle",e=this.centerY-i,s=this.unitsPerTickY;e>0;)t.moveTo(this.centerX-this.tickSize/2,e),t.lineTo(this.centerX+this.tickSize/2,e),t.stroke(),t.fillText(s,this.centerX-this.tickSize/2-3,e),s+=this.unitsPerTickY,e=Math.round(e-i);for(e=this.centerY+i,s=-1*this.unitsPerTickY;e<this.canvas.height;)t.moveTo(this.centerX-this.tickSize/2,e),t.lineTo(this.centerX+this.tickSize/2,e),t.stroke(),t.fillText(s,this.centerX-this.tickSize/2-3,e),s-=this.unitsPerTickY,e=Math.round(e+i);t.restore()},t.prototype.drawEquation=function(t,i,e,s){var n=this.context;n.save(),n.save(),this.transformContext(),n.beginPath(),n.moveTo(this.minX,t(this.minX));for(var a=this.minX+this.iteration;a<=this.maxX;a+=this.iteration)n.lineTo(a,t(a));n.restore(),n.lineJoin="round",n.lineWidth=e,""!=s&&n.setLineDash(s),n.strokeStyle=i,n.stroke(),n.restore()},t.prototype.transformContext=function(){var t=this.context;this.context.translate(this.centerX,this.centerY),t.scale(this.scaleX,-this.scaleY)};var e=[{period:44712,amplitude:.24,phase:0,color:"green",dashed:""},{period:43200,amplitude:1,phase:0,color:"red",dashed:""}],s=Math.floor(12/(e.length+1)),n=e.length,a=$("#template").html();for(i=1;i<=n;i++)waveTemplate=a.replace(new RegExp("{i}","g"),i),inputs=$("#inputs").html(),$("#inputs").html(inputs+""+waveTemplate);for($("#inputs > div").addClass("col-md-"+s),$(".actions").addClass("col-md-"+s),$("form").on("submit change",function(s){function a(t){for(sum=0,i=1;i<=n;i++){var e=$('[name="period_'+i+'"]').val(),s=$('[name="amplitude_'+i+'"]').val(),a=$('[name="phase_'+i+'"]').val();e>0&&(sum+=s*Math.cos(2*Math.PI/e*t-2*Math.PI*a))}return sum}s.preventDefault();var h=new t({canvasId:"summed",minX:-67068,minY:-2.1,maxX:67068,maxY:2.1,unitsPerTickX:14400,unitsPerTickY:1});h.drawEquation(function(t){return a(t)},"blue",thickness=6,"");var r=new t({canvasId:"single",minX:-67068,minY:-2.1,maxX:67068,maxY:2.1,unitsPerTickX:14400,unitsPerTickY:1});for(i=1;i<=n;i++)r.drawEquation(function(t){var e=$('[name="period_'+i+'"]').val(),s=$('[name="amplitude_'+i+'"]').val(),n=$('[name="phase_'+i+'"]').val();return e>0?s*Math.cos(2*Math.PI/e*t-2*Math.PI*n):null},e[i-1].color,thickness=6,e[i-1].dashed);r.drawEquation(function(t){return a(t)},"#888",thickness=6,[10,4])}),$("#M2M4").on("click",function(t){t.preventDefault(),$("#period-1").val(44712),$("#period-2").val(22356),$("#amplitude-1").val(1),$("#amplitude-2").val(.35),$("#phase-1").val(0),$("#phase-2").val(0),$("form").change()}),$("#sawTooth").on("click",function(t){t.preventDefault(),$("#period-1").val(44712),$("#period-2").val(22356),$("#amplitude-1").val(1),$("#amplitude-2").val(.35),$("#phase-1").val(0),$("#phase-2").val(.5),$("form").change()}),$("#aSymmetric").on("click",function(t){t.preventDefault(),$("#period-1").val(44712),$("#period-2").val(22356),$("#amplitude-1").val(1),$("#amplitude-2").val(.35),$("#phase-1").val(0),$("#phase-2").val(.25),$("form").change()}),i=1;i<=n;i++)$("#period-"+i).noUiSlider({start:[e[i-1].period],step:1,range:{min:[0],max:[89424]}}).on("slide",function(){$(this).change()}).Link("lower").to($('input[name="period_'+i+'"]')),$('input[name="period_'+i+'"]').keydown(function(t){var e=$("#period-"+i),s=Number(e.val()),n=e.noUiSlider("step");switch(n=n[0],t.which){case 13:$(this).change();break;case 38:e.val(s+n[1]),$(this).change();break;case 40:e.val(s-n[0]),$(this).change()}}),$("#amplitude-"+i).noUiSlider({start:[e[i-1].amplitude],step:.01,range:{min:[0],max:[1]}}).on("slide",function(){$(this).change()}).Link("lower").to($('input[name="amplitude_'+i+'"]')),$('input[name="amplitude_'+i+'"]').keydown(function(t){var e=$("#amplitude-"+i),s=Number(e.val()),n=e.noUiSlider("step");switch(n=n[0],t.which){case 13:$(this).change();break;case 38:e.val(s+n[1]),$(this).change();break;case 40:e.val(s-n[0]),$(this).change()}}),$("#phase-"+i).noUiSlider({start:[e[i-1].phase],step:.01,range:{min:[-1],max:[1]}}).on("slide",function(){$(this).change()}).Link("lower").to($('input[name="phase_'+i+'"]')),$('input[name="phase_'+i+'"]').keydown(function(t){var e=$("#phase-"+i),s=Number(e.val()),n=e.noUiSlider("step");switch(n=n[0],t.which){case 13:$(this).change();break;case 38:e.val(s+n[1]),$(this).change();break;case 40:e.val(s-n[0]),$(this).change()}})});