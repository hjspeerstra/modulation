$(function(){function t(i){this.canvas=document.getElementById(i.canvasId),this.minX=i.minX,this.minY=i.minY,this.maxX=i.maxX,this.maxY=i.maxY,this.unitsPerTickX=i.unitsPerTickX,this.unitsPerTickY=i.unitsPerTickY,this.resolution=i.resolution,this.axisColor="#aaa",this.font="18pt Crimson Text",this.tickSize=15,this.context=this.canvas.getContext("2d"),this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.restore(),this.rangeX=this.maxX-this.minX,this.rangeY=this.maxY-this.minY,this.unitX=this.canvas.width/this.rangeX,this.unitY=this.canvas.height/this.rangeY,this.centerY=Math.round(Math.abs(this.minY/this.rangeY)*this.canvas.height),this.centerX=Math.round(Math.abs(this.minX/this.rangeX)*this.canvas.width),this.iteration=(this.maxX-this.minX)/this.resolution,this.scaleX=this.canvas.width/this.rangeX,this.scaleY=this.canvas.height/this.rangeY,this.drawXAxis(),this.drawYAxis()}t.prototype.drawXAxis=function(){var i=this.context;i.save(),i.beginPath(),i.moveTo(0,this.centerY),i.lineTo(this.canvas.width,this.centerY),i.strokeStyle=this.axisColor,i.lineWidth=2,i.stroke();var t=this.unitsPerTickX*this.unitX,e,n;for(i.font=this.font,i.textAlign="center",i.textBaseline="top",e=this.centerX-t,n=-1*this.unitsPerTickX;e>0;)i.moveTo(e,this.centerY-this.tickSize/2),i.lineTo(e,this.centerY+this.tickSize/2),i.stroke(),i.fillText(n,e,this.centerY+this.tickSize/2+3),n-=this.unitsPerTickX,e=Math.round(e-t);for(e=this.centerX+t,n=this.unitsPerTickX;e<this.canvas.width;)i.moveTo(e,this.centerY-this.tickSize/2),i.lineTo(e,this.centerY+this.tickSize/2),i.stroke(),i.fillText(n,e,this.centerY+this.tickSize/2+3),n+=this.unitsPerTickX,e=Math.round(e+t);i.restore()},t.prototype.drawYAxis=function(){var i=this.context;i.save(),i.beginPath(),i.moveTo(this.centerX,0),i.lineTo(this.centerX,this.canvas.height),i.strokeStyle=this.axisColor,i.lineWidth=2,i.stroke();var t=this.unitsPerTickY*this.unitY,e,n;for(i.font=this.font,i.textAlign="right",i.textBaseline="middle",e=this.centerY-t,n=this.unitsPerTickY;e>0;)i.moveTo(this.centerX-this.tickSize/2,e),i.lineTo(this.centerX+this.tickSize/2,e),i.stroke(),i.fillText(n,this.centerX-this.tickSize/2-3,e),n+=this.unitsPerTickY,e=Math.round(e-t);for(e=this.centerY+t,n=-1*this.unitsPerTickY;e<this.canvas.height;)i.moveTo(this.centerX-this.tickSize/2,e),i.lineTo(this.centerX+this.tickSize/2,e),i.stroke(),i.fillText(n,this.centerX-this.tickSize/2-3,e),n-=this.unitsPerTickY,e=Math.round(e+t);i.restore()},t.prototype.drawEquation=function(i,t,e,n){var s=this.context;s.save(),s.save(),this.transformContext(),s.beginPath(),s.moveTo(this.minX,i(this.minX));for(var a=this.minX+this.iteration;a<=this.maxX;a+=this.iteration)s.lineTo(a,i(a));s.restore(),s.lineJoin="round",s.lineWidth=e,""!=n&&s.setLineDash(n),s.strokeStyle=t,s.stroke(),s.restore()},t.prototype.transformContext=function(){var i=this.context;this.context.translate(this.centerX,this.centerY),i.scale(this.scaleX,-this.scaleY)};var e=[{period:44712,amplitude:.24,phase:0,color:"green",dashed:""},{period:43200,amplitude:1,phase:0,color:"red",dashed:""}],n=Math.floor(12/(e.length+2)),s=e.length,a=$("#template").html();for(i=1;i<=s;i++)waveTemplate=a.replace(new RegExp("{i}","g"),i),inputs=$("#inputs").html(),$("#inputs").html(inputs+""+waveTemplate);for($("#inputs > div").addClass("col-md-"+n),$(".actions").addClass("col-md-"+n),$("form").on("submit change",function(n){function a(t){for(sum=0,i=1;i<=s;i++){var e=$('[name="period_'+i+'"]').val(),n=$('[name="amplitude_'+i+'"]').val(),a=$('[name="phase_'+i+'"]').val();e>0&&(sum+=n*Math.cos(2*Math.PI/e*t-2*Math.PI*a))}return sum}period1=$("#period-1").val(),period2=$("#period-2").val(),amountPeriods=$("#periods").val(),resolution=Math.ceil(400/amountPeriods)*amountPeriods,range=Math.max(period1,period2),minX=-.5*amountPeriods*range,maxX=.5*amountPeriods*range,tickSize=amountPeriods/10*range,n.preventDefault();var h=new t({canvasId:"summed",minX:minX,minY:-2.1,maxX:maxX,maxY:2.1,unitsPerTickX:tickSize,unitsPerTickY:1,resolution:resolution});h.drawEquation(function(i){return a(i)},"blue",thickness=4,"");var r=new t({canvasId:"single",minX:minX,minY:-2.1,maxX:maxX,maxY:2.1,unitsPerTickX:tickSize,unitsPerTickY:1,resolution:resolution});for(i=1;i<=s;i++)r.drawEquation(function(t){var e=$('[name="period_'+i+'"]').val(),n=$('[name="amplitude_'+i+'"]').val(),s=$('[name="phase_'+i+'"]').val();return e>0?n*Math.cos(2*Math.PI/e*t-2*Math.PI*s):null},e[i-1].color,thickness=4,e[i-1].dashed);r.drawEquation(function(i){return a(i)},"#888",thickness=4,"")}),$("#M2M4").on("click",function(i){i.preventDefault(),$("#period-1").val(44712),$("#period-2").val(22356),$("#amplitude-1").val(1),$("#amplitude-2").val(.35),$("#phase-1").val(0),$("#phase-2").val(0),$("#periods").val(4),$("form").change()}),$("#M2S2").on("click",function(i){i.preventDefault(),$("#period-1").val(44712),$("#period-2").val(43200),$("#amplitude-1").val(1),$("#amplitude-2").val(.3),$("#phase-1").val(0),$("#phase-2").val(0),$("#periods").val(75),$("form").change()}),$("#skewness").on("click",function(i){i.preventDefault(),$("#period-1").val(44712),$("#period-2").val(22356),$("#amplitude-1").val(1),$("#amplitude-2").val(.35),$("#phase-1").val(0),$("#phase-2").val(-.5),$("form").change()}),$("#asymmetric").on("click",function(i){i.preventDefault(),$("#period-1").val(44712),$("#period-2").val(22356),$("#amplitude-1").val(1),$("#amplitude-2").val(.35),$("#phase-1").val(0),$("#phase-2").val(.25),$("form").change()}),$("#periods").noUiSlider({start:5,step:.5,range:{min:[.5],max:[100]}}).on("slide",function(){$(this).change()}).Link("lower").to($('input[name="periods"]')),i=1;i<=s;i++)$("#period-"+i).noUiSlider({start:[e[i-1].period],step:.1,range:{min:[0],max:[89424]}}).on("slide",function(){$(this).change()}).Link("lower").to($('input[name="period_'+i+'"]')),$('input[name="period_'+i+'"]').keydown(function(t){var e=$("#period-"+i),n=Number(e.val()),s=e.noUiSlider("step");switch(s=s[0],t.which){case 13:$(this).change();break;case 38:e.val(n+s[1]),$(this).change();break;case 40:e.val(n-s[0]),$(this).change()}}),$("#amplitude-"+i).noUiSlider({start:[e[i-1].amplitude],step:.01,range:{min:[0],max:[1]}}).on("slide",function(){$(this).change()}).Link("lower").to($('input[name="amplitude_'+i+'"]')),$('input[name="amplitude_'+i+'"]').keydown(function(t){var e=$("#amplitude-"+i),n=Number(e.val()),s=e.noUiSlider("step");switch(s=s[0],t.which){case 13:$(this).change();break;case 38:e.val(n+s[1]),$(this).change();break;case 40:e.val(n-s[0]),$(this).change()}}),$("#phase-"+i).noUiSlider({start:[e[i-1].phase],step:.01,range:{min:[-1],max:[1]}}).on("slide",function(){$(this).change()}).Link("lower").to($('input[name="phase_'+i+'"]')),$('input[name="phase_'+i+'"]').keydown(function(t){var e=$("#phase-"+i),n=Number(e.val()),s=e.noUiSlider("step");switch(s=s[0],t.which){case 13:$(this).change();break;case 38:e.val(n+s[1]),$(this).change();break;case 40:e.val(n-s[0]),$(this).change()}})});